version: '3.8'

services:
  ha-history-mcp:
    image: ghcr.io/jtenniswood/ha-history-mcp:latest
    container_name: ha-history-mcp-server
    restart: unless-stopped
    
    environment:
      # REQUIRED: Replace with your Home Assistant details
      - HA_URL=https://your-homeassistant.com
      - HA_TOKEN=your-long-lived-access-token
      
      # OPTIONAL: Configuration (defaults shown)
      - REQUEST_TIMEOUT=30
      - PYTHONUNBUFFERED=1
      - PYTHONDONTWRITEBYTECODE=1
    
    # Security settings
    security_opt:
      - no-new-privileges:true
    
    # Resource limits (adjust as needed)
    deploy:
      resources:
        limits:
          memory: 512M
          cpus: '0.5'
        reservations:
          memory: 256M
          cpus: '0.1'
    
    # Health check
    healthcheck:
      test: ["CMD", "python", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s
    
    # Optional: Logging configuration
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"

# Instructions:
# 1. Replace HA_URL with your Home Assistant URL (e.g., https://homeassistant.local:8123)
# 2. Replace HA_TOKEN with your Home Assistant long-lived access token
# 3. Run: docker-compose -f docker-compose.public.yml up -d
# 4. Check logs: docker-compose -f docker-compose.public.yml logs -f